# XLua AssetBundle æ¡†æ¶ - æ•´ä½“æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
**XLua AssetBundle è‡ªåŠ¨åŒ–ç®¡ç†æ¡†æ¶**

### å½“å‰é¡¹ç›®çŠ¶æ€æ€»è§ˆ
ğŸ” **åˆ†ææ—¶é—´**: 2025-09-28  
ğŸ“Š **å®Œæˆåº¦**: 70% ï¼ˆæ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œå­˜åœ¨éƒ¨åˆ†é—®é¢˜å¾…ä¼˜åŒ–ï¼‰  
ğŸ¯ **ä¸»è¦åŠŸèƒ½**: AssetBundleè‡ªåŠ¨åŒ–æ‰“åŒ…ã€ä¾èµ–åˆ†æã€è¿è¡Œæ—¶åŠ è½½ç®¡ç†

### è®¾è®¡ç›®æ ‡
- ğŸ¯ **è‡ªåŠ¨åŒ–ä¾èµ–ç®¡ç†**: è‡ªåŠ¨åˆ†æå’Œå¤„ç†èµ„æºé—´çš„ä¾èµ–å…³ç³» âœ… **å·²å®ç°**
- ğŸ”„ **ç»Ÿä¸€å·¥ä½œæµç¨‹**: ä»æ‰“åŒ…åˆ°åŠ è½½çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆ âœ… **å·²å®ç°**
- ğŸš€ **å¼€å‘æ•ˆç‡æå‡**: ç®€åŒ–AssetBundleçš„ä½¿ç”¨å¤æ‚åº¦ âš ï¸ **éƒ¨åˆ†å®ç°**
- ğŸ› ï¸ **æ˜“ç»´æŠ¤æ€§**: æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»æ˜ç¡® âœ… **å·²å®ç°**

## ğŸ  å½“å‰é¡¹ç›®æ–‡ä»¶ç»“æ„

### å®é™…æ–‡ä»¶åˆ†å¸ƒ
```
XLuaFrameWorkRe/
â”œâ”€â”€ Assets/
â”‚   â”œâ”€â”€ BuildResources/          # èµ„æºæºæ–‡ä»¶å¤¹ï¼ˆå¾…æ‰“åŒ…èµ„æºï¼‰
â”‚   â”‚   â”œâ”€â”€ UI/
â”‚   â”‚   â”‚   â”œâ”€â”€ Prefabs/        # UIé¢„åˆ¶ä½“ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ Res/             # UIèµ„æºï¼ˆ8ä¸ªå›¾ç‰‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ Scenes/              # åœºæ™¯æ–‡ä»¶ï¼ˆ1ä¸ªåœºæ™¯ï¼‰
â”‚   â”‚   â”œâ”€â”€ Audio/               # éŸ³é¢‘èµ„æºï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ Effect/              # ç‰¹æ•ˆèµ„æºï¼ˆç©ºï¼‰
â”‚   â”‚   â”œâ”€â”€ Model/               # æ¨¡å‹èµ„æºï¼ˆç©ºï¼‰
â”‚   â”‚   â””â”€â”€ LuaScripts/          # Luaè„šæœ¬ï¼ˆç©ºï¼‰
â”‚   â”œâ”€â”€ StreamingAssets/         # è¾“å‡ºAssetBundleæ–‡ä»¶å¤¹
â”‚   â”‚   â”œâ”€â”€ filelist.txt         # ä¾èµ–å…³ç³»ç´¢å¼•æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ *.ab                 # å„ç§.abæ–‡ä»¶ï¼ˆ9ä¸ªï¼‰
â”‚   â”œâ”€â”€ Scripts/
â”‚   â”‚   â”œâ”€â”€ Editor/
â”‚   â”‚   â”‚   â””â”€â”€ BuildTool.cs     # æ‰“åŒ…å·¥å…·
â”‚   â”‚   â””â”€â”€ FrameWork/
â”‚   â”‚       â”œâ”€â”€ Util/
â”‚   â”‚       â”‚   â””â”€â”€ PathUtil.cs  # è·¯å¾„å·¥å…·
â”‚   â”‚       â”œâ”€â”€ AppConst.cs      # å¸¸é‡å®šä¹‰
â”‚   â”‚       â””â”€â”€ ResourceManager.cs # èµ„æºç®¡ç†å™¨
â”‚   â””â”€â”€ testLoad.cs              # æµ‹è¯•åŠ è½½è„šæœ¬
â””â”€â”€ AssetBundleæ¶æ„è®¾è®¡æ–‡æ¡£.md  # æœ¬æ–‡æ¡£
```

### èµ„æºç»Ÿè®¡ä¿¡æ¯
| èµ„æºç±»å‹ | æ•°é‡ | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|------|
| **UI Prefab** | 1ä¸ª | âœ… æ­£å¸¸ | SettingUIPrefab.prefab |
| **UI èµ„æº** | 8ä¸ª | âœ… æ­£å¸¸ | å„ç§å›¾ç‰‡èµ„æº |
| **åœºæ™¯æ–‡ä»¶** | 1ä¸ª | âœ… æ­£å¸¸ | TestScence1.unity |
| **AssetBundle** | 9ä¸ª | âœ… æ­£å¸¸ | å·²æˆåŠŸæ‰“åŒ… |
| **ç´¢å¼•æ–‡ä»¶** | 1ä¸ª | âš ï¸ é—®é¢˜ | filelist.txtå­˜åœ¨æ ¼å¼é—®é¢˜ |

## ğŸ” æ¡†æ¶åŠŸèƒ½ç°çŠ¶åˆ†æ

### å·²å®ç°åŠŸèƒ½æ¸…å• âœ…

#### 1. BuildTool.cs - æ‰“åŒ…å·¥å…·å±‚
**å®ç°çŠ¶æ€**: âœ… **åŠŸèƒ½å®Œæ•´**

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ“ **æ–‡ä»¶æ‰«æ**: é€’å½’æ‰«æ`Assets/BuildResources`ç›®å½•ä¸‹æ‰€æœ‰èµ„æº
- ğŸ”— **ä¾èµ–åˆ†æ**: ä½¿ç”¨`AssetDatabase.GetDependencies()`è‡ªåŠ¨åˆ†æèµ„æºä¾èµ–
- ğŸ› ï¸ **è·¯å¾„å¤„ç†**: ç»Ÿä¸€è·¯å¾„æ ¼å¼ï¼Œæ”¯æŒè·¨å¹³å°
- ğŸ“¦ **Bundleæ„å»º**: æŒ‰æ–‡ä»¶ç›®å½•ç»“æ„è‡ªåŠ¨ç”Ÿæˆ.abæ–‡ä»¶
- ğŸ“ **ç´¢å¼•ç”Ÿæˆ**: åˆ›å»º filelist.txt è®°å½•æ‰€æœ‰èµ„æºä¾èµ–å…³ç³»

**æ ¸å¿ƒæ–¹æ³•**:
```csharp
// ä¸»æ„å»ºæ–¹æ³•ï¼Œæ”¯æŒå¤šå¹³å°
static void Build(BuildTarget target)

// ä¾èµ–åˆ†æï¼Œè‡ªåŠ¨æ’é™¤C#è„šæœ¬
static List<string> GetDependence(string curFile)
```

**è®¾è®¡äº®ç‚¹**:
- âœ¨ è‡ªåŠ¨æ’é™¤`.cs`æ–‡ä»¶ï¼ˆå·²ç¼–è¯‘åˆ°ç¨‹åºä¸­ï¼‰
- âœ¨ æ”¯æŒå¤šå¹³å°æ„å»ºï¼ˆWindows/Android/iOSï¼‰
- âœ¨ å¯è¯»çš„èœå•æ¥å£ï¼š`Tools/BuildBundle`

#### 2. ResourceManager.cs - è¿è¡Œæ—¶ç®¡ç†å™¨
**å®ç°çŠ¶æ€**: âœ… **æ ¸å¿ƒåŠŸèƒ½å®Œæ•´**

**æ ¸å¿ƒæ•°æ®ç»“æ„**:
```csharp
internal class BundleInfo
{
    public string AssetsName;     // åŸå§‹èµ„æºè·¯å¾„
    public string BundleName;     // AssetBundleæ–‡ä»¶å
    public List<string> Dependences; // ä¾èµ–èµ„æºåˆ—è¡¨
}
```

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ“ˆ **ç´¢å¼•è§£æ**: å¯åŠ¨æ—¶è§£æ`filelist.txt`æ„å»ºå†…å­˜ç´¢å¼•
- ğŸ”„ **å¼‚æ­¥åŠ è½½**: åŸºäºCoroutineçš„å¼‚æ­¥èµ„æºåŠ è½½
- ğŸŒ³ **é€’å½’ä¾èµ–**: è‡ªåŠ¨é€’å½’åŠ è½½æ‰€æœ‰ä¾èµ–èµ„æº
- ğŸ“ **å›è°ƒæœºåˆ¶**: é€šè¿‡Actionå§”æ‰˜è¿”å›åŠ è½½ç»“æœ

**æ ¸å¿ƒæ–¹æ³•**:
```csharp
// è§£æç´¢å¼•æ–‡ä»¶
void ParseVersionFile()

// å¼‚æ­¥åŠ è½½èµ„æº
IEnumerator LoadBundleAsync(string assetName, Action<UObject> action)

// å…¬å¼€åŠ è½½æ¥å£
void LoadAsset(string assetName, Action<UObject> action)
```

#### 3. PathUtil.cs - è·¯å¾„å·¥å…·ç±»
**å®ç°çŠ¶æ€**: âœ… **åŠŸèƒ½å®Œæ•´**

**è·¯å¾„å¸¸é‡**:
```csharp
public static readonly string AssetsPath;           // Assetsæ–‡ä»¶å¤¹è·¯å¾„
public static readonly string BuildResourcesPath;   // å¾…æ‰“åŒ…èµ„æºè·¯å¾„
public static readonly string BundleOutPath;        // Bundleè¾“å‡ºè·¯å¾„
public static string BundleResourcePath;            // è¿è¡Œæ—¶Bundleè·¯å¾„
```

**å·¥å…·æ–¹æ³•**:
```csharp
// è½¬æ¢ä¸ºUnityç›¸å¯¹è·¯å¾„
public static string GetUnityPath(string path)

// æ ‡å‡†åŒ–è·¯å¾„åˆ†éš”ç¬¦
public static string GetStardardPath(string path)
```

#### 4. AppConst.cs - å¸¸é‡å®šä¹‰
**å®ç°çŠ¶æ€**: âœ… **åŠŸèƒ½å®Œæ•´**

```csharp
public class AppConst
{
    public const string BundleExtension = ".ab";        // Bundleæ–‡ä»¶æ‰©å±•å
    public const string FileListName = "filelist.txt";  // ç´¢å¼•æ–‡ä»¶å
}
```
### å½“å‰å­˜åœ¨çš„é—®é¢˜ âš ï¸

#### 1. æ•°æ®æ ¼å¼é—®é¢˜ ğŸ”´ **å…³é”®é—®é¢˜**
**é—®é¢˜æè¿°**: `filelist.txt`è§£ææ—¶å¯èƒ½å‡ºç°æ•°ç»„è¶Šç•Œ

**å…·ä½“è¡¨ç°**:
- å½“èµ„æºæ²¡æœ‰ä¾èµ–æ—¶ï¼Œ`info`æ•°ç»„åªæœ‰2ä¸ªå…ƒç´ 
- `ResourceManager.ParseVersionFile()`ä¸­çš„`for`å¾ªç¯ä»ç´¢å¼•2å¼€å§‹
- å¯èƒ½å¯¼è‡´è®¿é—®ä¸å­˜åœ¨çš„æ•°ç»„å…ƒç´ 

**å½±å“ç¨‹åº¦**: ğŸ”´ **é«˜** - å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ

**è§£å†³æ–¹æ¡ˆå»ºè®®**:
```csharp
// æ”¹è¿›åçš„è§£æé€»è¾‘
for (int j = 2; j < info.Length; j++) // æ·»åŠ è¾¹ç•Œæ£€æŸ¥
{
    if (j < info.Length) // å®‰å…¨æ£€æŸ¥
        bundleInfo.Dependences.Add(info[j]);
}
```

#### 2. æµ‹è¯•è„šæœ¬çš„ä¸ä¸€è‡´æ€§ ğŸŸ¡ **ä¸­ç­‰é—®é¢˜**
**é—®é¢˜æè¿°**: `testLoad.cs`æœªä½¿ç”¨æ–°çš„ResourceManagerç³»ç»Ÿ

**å…·ä½“è¡¨ç°**:
- `testLoad.cs`ç›´æ¥ä½¿ç”¨`AssetBundle.LoadFromFileAsync`
- `ResourceManager.cs`åœ¨`Start()`ä¸­æœ‰è‡ªå·±çš„åŠ è½½é€»è¾‘
- ä¸¤ä¸ªåŠ è½½æ–¹å¼å¯èƒ½äº§ç”Ÿå†²çª

**å½±å“ç¨‹åº¦**: ğŸŸ¡ **ä¸­** - å½±å“æµ‹è¯•çš„å‡†ç¡®æ€§

#### 3. ç¼ºå°‘é”™è¯¯å¤„ç† ğŸŸ¡ **ä¸­ç­‰é—®é¢˜**
**é—®é¢˜æè¿°**: æ²¡æœ‰å……åˆ†çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

**ç¼ºå°‘çš„å¤„ç†**:
- æ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µ
- èµ„æºåŠ è½½å¤±è´¥çš„æƒ…å†µ
- ç½‘ç»œé—®é¢˜æˆ–æƒé™é—®é¢˜

### ä¼˜åŒ–å»ºè®®æ¸…å• ğŸ’¡

#### çŸ­æœŸä¼˜åŒ– ï¼ˆç´§æ€¥ï¼‰
1. âœ… **ä¿®å¤`filelist.txt`è§£æbug**
2. âœ… **æ·»åŠ åŸºæœ¬é”™è¯¯å¤„ç†**
3. âœ… **ç»Ÿä¸€æµ‹è¯•è„šæœ¬**

#### ä¸­æœŸä¼˜åŒ– ï¼ˆé‡è¦ï¼‰
4. â­• **æ·»åŠ èµ„æºç¼“å­˜æœºåˆ¶**
5. â­• **å®ç°å•ä¾‹æ¨¡å¼çš„ResourceManager**
6. â­• **æ·»åŠ åŠ è½½è¿›åº¦å›è°ƒ**
7. â­• **æ”¯æŒèµ„æºå¸è½½æœºåˆ¶**

#### é•¿æœŸä¼˜åŒ– ï¼ˆæå‡ï¼‰
8. âšª **æ·»åŠ çƒ­æ›´æ–°æ”¯æŒ**
9. âšª **å®ç°å¯¹è±¡æ± ç®¡ç†**
10. âšª **æ·»åŠ èµ„æºåŠ å¯†æ”¯æŒ**
11. âšª **å®ç°åˆ†å¸§åŠ è½½**

## ğŸ§ ç³»ç»Ÿæ¶æ„è®¾è®¡

### åˆ†å±‚æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          æµ‹è¯•éªŒè¯å±‚                  â”‚  testLoad.cs
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          ä¸šåŠ¡æ¥å£å±‚                  â”‚  ResourceManager.cs
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          å·¥å…·æ”¯æ’‘å±‚                  â”‚  PathUtil.cs, AppConst.cs
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æ„å»ºå·¥å…·å±‚                  â”‚  BuildTool.cs
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          æ•°æ®å­˜å‚¨å±‚                  â”‚  filelist.txt, *.ab files
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè½¬å…³ç³»
```mermaid
graph TB
    subgraph "å¼€å‘é˜¶æ®µ"
        A[ç¾æœ¯èµ„æº] --> B[BuildResourcesæ–‡ä»¶å¤¹]
    end
    
    subgraph "æ‰“åŒ…é˜¶æ®µ"
        B --> C[BuildToolæ‰«æ]
        C --> D[ä¾èµ–åˆ†æ]
        D --> E[ç”ŸæˆAssetBundle]
        E --> F[ç”Ÿæˆfilelist.txt]
    end
    
    subgraph "è¿è¡Œæ—¶é˜¶æ®µ"
        F --> G[ResourceManagerè§£æ]
        G --> H[æ„å»ºå†…å­˜ç´¢å¼•]
        H --> I[å“åº”åŠ è½½è¯·æ±‚]
        I --> J[æ™ºèƒ½ä¾èµ–åŠ è½½]
        J --> K[è¿”å›æ¸¸æˆå¯¹è±¡]
    end
    
    subgraph "æµ‹è¯•é˜¶æ®µ"
        K --> L[testLoadéªŒè¯]
        L --> M[æ˜¾ç¤ºåˆ°åœºæ™¯]
    end
```

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### ä»å¼€å‘åˆ°è¿è¡Œçš„å®Œæ•´æµç¨‹
```mermaid
graph TD
    A[å¼€å‘è€…åˆ›å»ºèµ„æº] --> B[æ”¾ç½®åˆ° BuildResources]
    B --> C[ç‚¹å‡» Tools/BuildBundle èœå•]
    C --> D[BuildTool æ‰«æèµ„æºæ–‡ä»¶]
    D --> E[åˆ†ææ¯ä¸ªèµ„æºçš„ä¾èµ–å…³ç³»]
    E --> F[ç”Ÿæˆ AssetBundle é…ç½®]
    F --> G[æ„å»º .ab æ–‡ä»¶]
    G --> H[ç”Ÿæˆ filelist.txt]
    H --> I[æ¸¸æˆè¿è¡Œæ—¶å¯åŠ¨]
    I --> J[ResourceManager è§£æç´¢å¼•]
    J --> K[æ„å»ºå†…å­˜ä¸­çš„èµ„æºå­—å…¸]
    K --> L[æ¥æ”¶èµ„æºåŠ è½½è¯·æ±‚]
    L --> M[æ™ºèƒ½ä¾èµ–åŠ è½½]
    M --> N[è¿”å›æ¸¸æˆå¯¹è±¡]
    N --> O[æ˜¾ç¤ºåˆ°æ¸¸æˆåœºæ™¯]
```

### å½“å‰å®é™…è¿è¡Œæƒ…å†µ

#### æˆåŠŸæ¡ˆä¾‹åˆ†æ âœ…
**èµ„æº**: `Assets/BuildResources/UI/Prefabs/SettingUIPrefab.prefab`

**æµç¨‹è¿½è¸ª**:
1. ğŸ“ **æ–‡ä»¶å‘ç°**: BuildToolæ‰«æåˆ°UI Prefabæ–‡ä»¶
2. ğŸ”— **ä¾èµ–åˆ†æ**: å‘ç°ä¾èµ–`background.png`å’Œ`button_150.png`
3. ğŸ“¦ **æ‰“åŒ…ç”Ÿæˆ**: ç”Ÿæˆ`ui/prefabs/settinguiprefab.prefab.ab`
4. ğŸ“ **ç´¢å¼•è®°å½•**: åœ¨filelist.txtä¸­è®°å½•ä¾èµ–å…³ç³»
5. ğŸ® **è¿è¡Œæ—¶**: ResourceManageræ­£ç¡®åŠ è½½æ‰€æœ‰ä¾èµ–

**filelist.txtä¸­çš„è®°å½•**:
```
Assets/BuildResources/UI/Prefabs/SettingUIPrefab.prefab|ui/prefabs/settinguiprefab.prefab.ab|Assets/BuildResources/UI/Res/button_150.png|Assets/BuildResources/UI/Res/background.png
```

#### æµ‹è¯•è„šæœ¬å¯¹æ¯” ğŸ”

**testLoad.cs (ç›´æ¥åŠ è½½)**:
```csharp
// æ‰‹åŠ¨åŠ è½½æ‰€æœ‰ä¾èµ–
AssetBundle.LoadFromFileAsync(".../settinguiprefab.prefab.ab");
AssetBundle.LoadFromFileAsync(".../background.png.ab");
AssetBundle.LoadFromFileAsync(".../button_150.png.ab");
```

**ResourceManager.cs (æ™ºèƒ½åŠ è½½)**:
```csharp
// è‡ªåŠ¨å¤„ç†ä¾èµ–
LoadAsset("Assets/BuildResources/UI/Prefabs/SettingUIPrefab.prefab", OnComplete);
// å†…éƒ¨è‡ªåŠ¨é€’å½’åŠ è½½æ‰€æœ‰ä¾èµ–
```

### æ•°æ®ç»“æ„åˆ†æ

#### filelist.txt æ•°æ®æ ¼å¼
**å½“å‰æ ¼å¼**: `èµ„æºè·¯å¾„|åŒ…å|ä¾èµ–6|ä¾èµ–7...`

**å®é™…æ•°æ®ç¤ºä¾‹**:
```
Assets/BuildResources/UI/Prefabs/SettingUIPrefab.prefab|ui/prefabs/settinguiprefab.prefab.ab|Assets/BuildResources/UI/Res/button_150.png|Assets/BuildResources/UI/Res/background.png
Assets/BuildResources/UI/Res/background.png|ui/res/background.png.ab
Assets/BuildResources/Scenes/TestScence1.unity|scenes/testscence1.unity.ab
```

**æ•°æ®ç»“æ„è¡¨**:
| å­—æ®µä½ç½® | å­—æ®µåç§° | ç¤ºä¾‹å€¼ | è¯´æ˜ |
|----------|----------|----------|----------|
| `info[0]` | AssetsName | `Assets/BuildResources/UI/Prefabs/SettingUIPrefab.prefab` | åŸå§‹èµ„æºè·¯å¾„ |
| `info[1]` | BundleName | `ui/prefabs/settinguiprefab.prefab.ab` | ç”Ÿæˆçš„Bundleæ–‡ä»¶å |
| `info[2+]` | Dependences | `Assets/BuildResources/UI/Res/button_150.png` | ä¾èµ–èµ„æºåˆ—è¡¨ |

#### BundleInfo ç±»ç»“æ„
```csharp
internal class BundleInfo
{
    public string AssetsName;     // å¯¹åº” info[0]
    public string BundleName;     // å¯¹åº” info[1] 
    public List<string> Dependences; // å¯¹åº” info[2], info[3]...
}
```

### ç»„ä»¶äº¤äº’å…³ç³»

```mermaid
graph LR
    A[PathUtil] --> B[BuildTool]
    A --> C[ResourceManager]
    D[AppConst] --> C
    B --> E[filelist.txt]
    B --> F[*.ab files]
    E --> C
    F --> C
    
    subgraph "æ„å»ºé˜¶æ®µ"
        B
        E
        F
    end
    
    subgraph "è¿è¡Œé˜¶æ®µ"
        C
    end
    
    subgraph "å·¥å…·å±‚"
        A
        D
    end
```

### BuildTool.cs - æ„å»ºå·¥å…·å±‚
**è®¾è®¡èŒè´£**: AssetBundleè‡ªåŠ¨åŒ–æ‰“åŒ…å’Œä¾èµ–åˆ†æ

**æ ¸å¿ƒå·¥ä½œæµç¨‹**:
1. **æ–‡ä»¶æ‰«æ**: éå†`Assets/BuildResources`ç›®å½•ä¸‹æ‰€æœ‰èµ„æº
2. **ä¾èµ–åˆ†æ**: ä½¿ç”¨`AssetDatabase.GetDependencies()`åˆ†ææ¯ä¸ªèµ„æºçš„ä¾èµ–
3. **è·¯å¾„å¤„ç†**: é€šè¿‡PathUtilç»Ÿä¸€å¤„ç†è·¯å¾„æ ¼å¼
4. **é…ç½®ç”Ÿæˆ**: åˆ›å»ºAssetBundleBuildé…ç½®å¯¹è±¡
5. **æ–‡ä»¶æ„å»º**: è°ƒç”¨Unityçš„BuildPipelineç”Ÿæˆ.abæ–‡ä»¶
6. **ç´¢å¼•è®°å½•**: ç”Ÿæˆfilelist.txtè®°å½•æ‰€æœ‰ä¾èµ–å…³ç³»

**å…³é”®è®¾è®¡ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨æ’é™¤C#è„šæœ¬æ–‡ä»¶ï¼ˆå·²ç¼–è¯‘åˆ°ç¨‹åºä¸­ï¼‰
- âœ… æ”¯æŒé€’å½’ä¾èµ–åˆ†æ
- âœ… è·¨å¹³å°è·¯å¾„å¤„ç†

### ResourceManager.cs - è¿è¡Œæ—¶ç®¡ç†å±‚
**è®¾è®¡èŒè´£**: æ™ºèƒ½èµ„æºåŠ è½½å’Œä¾èµ–ç®¡ç†

**æ ¸å¿ƒæ•°æ®ç»“æ„**:
```csharp
internal class BundleInfo
{
    public string AssetsName;    // åŸå§‹èµ„æºè·¯å¾„
    public string BundleName;    // AssetBundleæ–‡ä»¶å
    public List<string> Dependences; // ä¾èµ–èµ„æºåˆ—è¡¨
}
```

**åŠ è½½å·¥ä½œæµç¨‹**:
1. **ç´¢å¼•æ„å»º**: å¯åŠ¨æ—¶è§£æfilelist.txtæ„å»ºå†…å­˜ç´¢å¼•
2. **ä¾èµ–æ£€æŸ¥**: æ¥æ”¶åŠ è½½è¯·æ±‚æ—¶æ£€æŸ¥ä¾èµ–å…³ç³»
3. **é€’å½’åŠ è½½**: æŒ‰ä¾èµ–é¡ºåºé€’å½’åŠ è½½æ‰€æœ‰ç›¸å…³AssetBundle
4. **èµ„æºæå–**: ä»æ­£ç¡®çš„AssetBundleä¸­æå–ç›®æ ‡èµ„æº
5. **å›è°ƒé€šçŸ¥**: é€šè¿‡å§”æ‰˜å›è°ƒè¿”å›åŠ è½½ç»“æœ

### PathUtil.cs - å·¥å…·æ”¯æ’‘å±‚
**è®¾è®¡èŒè´£**: ç»Ÿä¸€è·¯å¾„å¤„ç†å’Œæ ¼å¼æ ‡å‡†åŒ–

**æ ¸å¿ƒæ–¹æ³•è¯´æ˜**:
- `GetUnityPath()`: å°†å®Œæ•´è·¯å¾„è½¬æ¢ä¸ºUnityè¯†åˆ«çš„ç›¸å¯¹è·¯å¾„
- `GetStardardPath()`: ç»Ÿä¸€è·¯å¾„åˆ†éš”ç¬¦ä¸ºæ­£æ–œæ ï¼ˆè·¨å¹³å°å…¼å®¹ï¼‰
- è·¯å¾„å¸¸é‡å®šä¹‰: ç»Ÿä¸€ç®¡ç†å„ç§è·¯å¾„é…ç½®

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### å¼€å‘åˆ°è¿è¡Œçš„å®Œæ•´æµç¨‹å›¾
```mermaid
graph TD
    A[å¼€å‘è€…åˆ›å»ºèµ„æº] --> B[æ”¾ç½®åˆ° BuildResources]
    B --> C[ç‚¹å‡» Tools/BuildBundle èœå•]
    C --> D[BuildTool æ‰«æèµ„æºæ–‡ä»¶]
    D --> E[åˆ†ææ¯ä¸ªèµ„æºçš„ä¾èµ–å…³ç³»]
    E --> F[ç”Ÿæˆ AssetBundle é…ç½®]
    F --> G[æ„å»º .ab æ–‡ä»¶]
    G --> H[ç”Ÿæˆ filelist.txt]
    H --> I[æ¸¸æˆè¿è¡Œæ—¶å¯åŠ¨]
    I --> J[ResourceManager è§£æç´¢å¼•]
    J --> K[æ„å»ºå†…å­˜ä¸­çš„èµ„æºå­—å…¸]
    K --> L[æ¥æ”¶èµ„æºåŠ è½½è¯·æ±‚]
    L --> M[æ™ºèƒ½ä¾èµ–åŠ è½½]
    M --> N[è¿”å›æ¸¸æˆå¯¹è±¡]
    N --> O[æ˜¾ç¤ºåˆ°æ¸¸æˆåœºæ™¯]
```

### æ•°æ®æµè½¬å…³ç³»
```mermaid
graph LR
    subgraph "å¼€å‘é˜¶æ®µ"
        A[ç¾æœ¯èµ„æº] --> B[BuildResourcesæ–‡ä»¶å¤¹]
    end
    
    subgraph "æ‰“åŒ…é˜¶æ®µ"
        B --> C[BuildToolæ‰«æ]
        C --> D[ä¾èµ–åˆ†æ]
        D --> E[ç”ŸæˆAssetBundle]
        E --> F[ç”Ÿæˆfilelist.txt]
    end
    
    subgraph "è¿è¡Œæ—¶é˜¶æ®µ"
        F --> G[ResourceManagerè§£æ]
        G --> H[æ„å»ºå†…å­˜ç´¢å¼•]
        H --> I[å“åº”åŠ è½½è¯·æ±‚]
        I --> J[æ™ºèƒ½ä¾èµ–åŠ è½½]
        J --> K[è¿”å›æ¸¸æˆå¯¹è±¡]
    end
    
    subgraph "æµ‹è¯•é˜¶æ®µ"
        K --> L[testLoadéªŒè¯]
        L --> M[æ˜¾ç¤ºåˆ°åœºæ™¯]
    end
```

## ğŸ“ˆ æ•°æ®å¤„ç†æµç¨‹

### æ•°æ®è½¬æ¢ç®¡çº¿
| é˜¶æ®µ | è¾“å…¥æ•°æ® | å¤„ç†è¿‡ç¨‹ | è¾“å‡ºæ•°æ® | ä½œç”¨è¯´æ˜ |
|------|----------|----------|----------|----------|
| **æ–‡ä»¶å‘ç°** | `Assets/BuildResources/*` | `Directory.GetFiles()` | æ–‡ä»¶è·¯å¾„æ•°ç»„ | ğŸ” å‘ç°æ‰€æœ‰å¾…æ‰“åŒ…èµ„æº |
| **è·¯å¾„æ ‡å‡†åŒ–** | å®Œæ•´æ–‡ä»¶è·¯å¾„ | `PathUtil.GetUnityPath()` | Unityç›¸å¯¹è·¯å¾„ | ğŸ›¤ï¸ ç»Ÿä¸€è·¯å¾„æ ¼å¼ |
| **ä¾èµ–åˆ†æ** | Unityèµ„æºè·¯å¾„ | `AssetDatabase.GetDependencies()` | ä¾èµ–è·¯å¾„åˆ—è¡¨ | ğŸ”— å»ºç«‹èµ„æºå…³è”å›¾ |
| **ä¿¡æ¯æ‰“åŒ…** | è·¯å¾„+Bundleå+ä¾èµ– | å­—ç¬¦ä¸²æ‹¼æ¥ç»„åˆ | bundleInfoå­—ç¬¦ä¸² | ğŸ“ åˆ›å»ºèµ„æºæè¿° |
| **æ–‡ä»¶æ„å»º** | AssetBundleBuildé…ç½® | `BuildPipeline.BuildAssetBundles()` | .abäºŒè¿›åˆ¶æ–‡ä»¶ | ğŸ—ï¸ ç”Ÿæˆæœ€ç»ˆèµ„æºåŒ… |
| **ç´¢å¼•è§£æ** | filelist.txtå†…å®¹ | `Split('|')` å­—ç¬¦ä¸²åˆ†å‰² | BundleInfoå¯¹è±¡ | ğŸ—‚ï¸ æ„å»ºè¿è¡Œæ—¶ç´¢å¼• |
| **èµ„æºå®ä¾‹åŒ–** | èµ„æºåŠ è½½è¯·æ±‚ | å¼‚æ­¥åŠ è½½æµç¨‹ | GameObjectå®ä¾‹ | ğŸ® äº¤ä»˜æ¸¸æˆä½¿ç”¨ |

## âš¡ æŠ€æœ¯ç‰¹ç‚¹ä¸ä¼˜åŠ¿

### ç³»ç»Ÿç‰¹ç‚¹
- **ğŸ¤– é«˜åº¦è‡ªåŠ¨åŒ–**: ä¾èµ–å…³ç³»è‡ªåŠ¨åˆ†æï¼Œæ— éœ€æ‰‹å·¥ç»´æŠ¤
- **ğŸ”§ æ¨¡å—åŒ–è®¾è®¡**: å„ç»„ä»¶èŒè´£å•ä¸€ï¼Œè€¦åˆåº¦ä½
- **ğŸŒ è·¨å¹³å°æ”¯æŒ**: è€ƒè™‘ä¸åŒå¹³å°çš„è·¯å¾„å·®å¼‚
- **ğŸ“Š æ€§èƒ½ä¼˜åŒ–**: æŒ‰éœ€åŠ è½½ï¼Œé¿å…å†…å­˜æµªè´¹
- **ğŸ” æ˜“äºè°ƒè¯•**: ç”Ÿæˆå¯è¯»çš„ä¾èµ–ä¿¡æ¯æ–‡ä»¶

### æ¶æ„ä¼˜åŠ¿
1. **å¼€å‘å‹å¥½**: å¼€å‘è€…åªéœ€å…³æ³¨èµ„æºåˆ›å»ºï¼Œæ— éœ€å…³å¿ƒå¤æ‚çš„ä¾èµ–ç®¡ç†
2. **ç»´æŠ¤ç®€å•**: ä¾èµ–å…³ç³»è‡ªåŠ¨ç»´æŠ¤ï¼Œå‡å°‘äººå·¥é”™è¯¯
3. **æ‰©å±•çµæ´»**: ç»„ä»¶åŒ–è®¾è®¡ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
4. **æ€§èƒ½å¯æ§**: æä¾›ç»†ç²’åº¦çš„èµ„æºåŠ è½½æ§åˆ¶

## ğŸ”§ å½“å‰é¡¹ç›®çŠ¶æ€

### å·²å®ç°åŠŸèƒ½ âœ…
- [x] è‡ªåŠ¨æ–‡ä»¶æ‰«æå’Œè·¯å¾„å¤„ç†
- [x] æ™ºèƒ½ä¾èµ–å…³ç³»åˆ†æ  
- [x] AssetBundleè‡ªåŠ¨æ„å»º
- [x] ä¾èµ–ä¿¡æ¯æ–‡ä»¶ç”Ÿæˆ
- [x] åŸºç¡€çš„è¿è¡Œæ—¶åŠ è½½æ¡†æ¶
- [x] æµ‹è¯•éªŒè¯è„šæœ¬

### å¾…è§£å†³é—®é¢˜ âŒ
- [ ] **æ•°æ®æ ¼å¼bug**: filelist.txtè§£ææ—¶æ•°ç»„è¶Šç•Œ
- [ ] **é”™è¯¯å¤„ç†ç¼ºå¤±**: ç¼ºå°‘æ–‡ä»¶ä¸å­˜åœ¨ç­‰å¼‚å¸¸å¤„ç†
- [ ] **æµ‹è¯•ä¸å®Œæ•´**: testLoadæœªä½¿ç”¨æ–°çš„ResourceManagerç³»ç»Ÿ
- [ ] **æ–‡æ¡£ç¼ºä¹**: ç¼ºå°‘ä½¿ç”¨è¯´æ˜å’ŒAPIæ–‡æ¡£

### ä¼˜åŒ–å»ºè®® ğŸ’¡
1. **ä¿®å¤æ•°æ®æ ¼å¼**: åœ¨èµ„æºè·¯å¾„å’ŒBundleåç§°é—´æ·»åŠ æ˜ç¡®åˆ†éš”ç¬¦
2. **å®Œå–„é”™è¯¯å¤„ç†**: æ·»åŠ å¼‚å¸¸æ•è·å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
3. **é›†æˆæµ‹è¯•**: è®©testLoadä½¿ç”¨ResourceManagerè€Œéç¡¬ç¼–ç åŠ è½½
4. **æ€§èƒ½ä¼˜åŒ–**: æ·»åŠ èµ„æºç¼“å­˜å’Œå†…å­˜ç®¡ç†æœºåˆ¶

## ğŸ“– ä½¿ç”¨æŒ‡å—

### å¼€å‘æµç¨‹
1. **èµ„æºå‡†å¤‡**: å°†éœ€è¦æ‰“åŒ…çš„èµ„æºæ”¾åˆ°`Assets/BuildResources`æ–‡ä»¶å¤¹
2. **æ‰§è¡Œæ‰“åŒ…**: åœ¨Unityç¼–è¾‘å™¨ä¸­é€‰æ‹©èœå•`Tools/BuildBundle/Build Windows Bundle`
3. **éªŒè¯ç»“æœ**: æ£€æŸ¥`Assets/StreamingAssets`æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆçš„.abæ–‡ä»¶å’Œfilelist.txt
4. **è¿è¡Œæµ‹è¯•**: å¯åŠ¨æ¸¸æˆï¼ŒResourceManagerä¼šè‡ªåŠ¨å¤„ç†èµ„æºåŠ è½½

### APIä½¿ç”¨ç¤ºä¾‹
```csharp
// æ¨èçš„èµ„æºåŠ è½½æ–¹å¼
ResourceManager.Instance.LoadAsset(
    "Assets/BuildResources/UI/Prefabs/MainUI.prefab", 
    (obj) => {
        GameObject ui = Instantiate(obj) as GameObject;
        // å¤„ç†åŠ è½½å®Œæˆçš„UIå¯¹è±¡
    }
);
```

## ğŸ¯ è®¾è®¡ç†å¿µæ€»ç»“

è¿™ä¸ªAssetBundleæ¡†æ¶ä½“ç°äº†ä»¥ä¸‹è½¯ä»¶è®¾è®¡ç†å¿µï¼š

- **å•ä¸€èŒè´£åŸåˆ™**: æ¯ä¸ªç»„ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
- **å¼€é—­åŸåˆ™**: å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
- **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–äºæŠ½è±¡
- **è‡ªåŠ¨åŒ–ä¼˜å…ˆ**: èƒ½è‡ªåŠ¨åŒ–çš„ç»ä¸æ‰‹å·¥æ“ä½œ
- **ç”¨æˆ·ä½“éªŒ**: ç®€åŒ–å¼€å‘è€…çš„ä½¿ç”¨å¤æ‚åº¦

é€šè¿‡è¿™æ ·çš„è®¾è®¡ï¼Œå®ç°äº†ä¸€ä¸ª**å®Œæ•´ã€è‡ªåŠ¨åŒ–ã€æ˜“ç»´æŠ¤**çš„AssetBundleç®¡ç†ç³»ç»Ÿï¼Œä¸ºUnityé¡¹ç›®çš„èµ„æºç®¡ç†æä¾›äº†å¼ºæœ‰åŠ›çš„æŠ€æœ¯æ”¯æ’‘ã€‚

---
*æ–‡æ¡£ç‰ˆæœ¬: v1.0*  
*æ›´æ–°æ—¥æœŸ: 2025-09-27*  
*é€‚ç”¨é¡¹ç›®: XLua AssetBundle Framework*